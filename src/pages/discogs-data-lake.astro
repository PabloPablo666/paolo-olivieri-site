---
import Base from "../layouts/Base.astro";

const repoMeta = "https://github.com/PabloPablo666/discogs-lakehouse";
const repoInfra = "https://github.com/PabloPablo666/trino-hive-setup";
const repoPipelines = "https://github.com/PabloPablo666/discogs_tools_refactor";
---

<Base
  title="Discogs Lakehouse · Paolo Olivieri"
  description="Local-first Discogs lakehouse: typed Parquet + Trino + Hive Metastore, with reproducible pipelines and browser-friendly DuckDB WASM demos."
>
  <h1>Discogs Lakehouse</h1>

  <p class="muted">
    Local-first analytical lakehouse on <strong>Trino</strong> + <strong>Hive Metastore</strong> over
    <strong>external typed Parquet</strong>. Built for reproducible Discogs analytics and tooling.
  </p>

  <div style="display:flex; gap:12px; flex-wrap:wrap; margin: 16px 0 22px;">
    <a class="btn" href="/discogs/showcase">Showcase queries</a>
    <a class="btn" href="/discogs/explore">Explore (SQL)</a>
    <a class="btn" href={repoMeta} target="_blank" rel="noopener noreferrer">GitHub (meta)</a>
  </div>

  <div class="card">
    <h3 style="margin-top:0">What this is</h3>
    <ul>
      <li>End-to-end local lakehouse (no cloud dependency)</li>
      <li>Typed Parquet datasets (<code>*_typed</code>) + versioned reference tables (<code>*_ref_vN</code>)</li>
      <li>Join-friendly “warehouse” bridges (name resolution, xrefs, canon/dedup)</li>
      <li>Browser demo: same schema surfaced via DuckDB WASM for this site</li>
    </ul>
  </div>

  <h2>Architecture</h2>
  <div class="card">
    <ul>
      <li><strong>Storage</strong>: external Parquet (persistent, outside containers)</li>
      <li><strong>Metadata</strong>: Hive Metastore backed by Postgres</li>
      <li><strong>Compute</strong>: Trino (stateless)</li>
      <li><strong>Pipelines</strong>: Python parsers → typed datasets → derived/warehouse tables</li>
    </ul>
    <p class="muted small" style="margin-top:10px;">
      Compute and metastore can be rebuilt without touching the data lake.
    </p>
  </div>

  <h2>Data model</h2>
  <div class="card">
    <p class="muted" style="margin-top:0;">
      Core entities + versioned references + derived bridges for joins and analytics.
    </p>

    <ul>
      <li><strong>Entities (typed + raw/view)</strong>:
        <code>artists_v1</code> / <code>artists_v1_typed</code>,
        <code>masters_v1</code> / <code>masters_v1_typed</code>,
        <code>artist_aliases_v1</code> / <code>artist_aliases_v1_typed</code>,
        <code>artist_memberships_v1</code> / <code>artist_memberships_v1_typed</code>
      </li>

      <li><strong>References</strong>:
        <code>releases_ref_v6</code>,
        <code>labels_ref_v10</code>
      </li>

      <li><strong>Bridges / xrefs</strong>:
        <code>artist_name_map_v1</code>,
        <code>release_artists_v1</code>,
        <code>release_label_xref_v1</code>,
        <code>release_genre_xref_v1</code>,
        <code>release_style_xref_v1</code>
      </li>

      <li><strong>Cleaned variants / metrics</strong>:
        <code>release_label_xref_v1_canon</code>,
        <code>release_label_xref_v1_dedup</code>,
        <code>label_release_counts_v1</code>
      </li>

      <li><strong>Collection</strong>: <code>collection</code> (optional snapshot dataset)</li>
    </ul>
  </div>

  <h2>Reproducibility</h2>
  <div class="card">
    <ul>
      <li>Idempotent bootstrap SQL registers external tables and views</li>
      <li>External storage is persistent; containers are disposable</li>
      <li>Sanity checks quantify drift and upstream inconsistencies</li>
    </ul>
  </div>

  <h2>Repositories</h2>
  <div class="card">
    <ul>
      <li>
        <a href={repoMeta} target="_blank" rel="noopener noreferrer">
          Meta repository (overview + links)
        </a>
      </li>
      <li>
        <a href={repoInfra} target="_blank" rel="noopener noreferrer">
          Infrastructure: Trino + Hive Metastore + bootstrap SQL
        </a>
      </li>
      <li>
        <a href={repoPipelines} target="_blank" rel="noopener noreferrer">
          Pipelines + tests + SQL (typed datasets + derived tables)
        </a>
      </li>
    </ul>
  </div>

  <h2>Notes</h2>
  <div class="card">
    <p class="muted" style="margin:0;">
      Discogs data is subject to Discogs licensing. This project focuses on infrastructure,
      pipelines, schema design and demo queries, and does not redistribute proprietary datasets.
    </p>
  </div>
</Base>
