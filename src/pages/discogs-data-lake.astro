---
import Base from "../layouts/Base.astro";

const repoMeta = "https://github.com/PabloPablo666/discogs-lakehouse";
const repoInfra = "https://github.com/PabloPablo666/trino-hive-setup";
const repoPipelines = "https://github.com/PabloPablo666/discogs_tools_refactor";
---

<Base
  title="Discogs Lakehouse Â· Paolo Olivieri"
  description="Local-first Discogs lakehouse with orchestrated, run-based pipelines and immutable Parquet snapshots."
>
  <h1>Discogs Lakehouse</h1>

  <p class="muted">
    A local-first analytical lakehouse for Discogs data, built around
    <strong>run-based execution</strong>, <strong>orchestrated pipelines</strong>
    and <strong>immutable Parquet snapshots</strong>.
  </p>

  <div style="display:flex; gap:12px; flex-wrap:wrap; margin: 16px 0 22px;">
    <a class="btn" href="/discogs/showcase">Showcase queries</a>
    <a class="btn" href="/discogs/explore">Explore (SQL)</a>
    <a class="btn" href={repoMeta} target="_blank" rel="noopener noreferrer">GitHub</a>
  </div>

  <div class="card">
    <h3 style="margin-top:0">What this project is</h3>
    <ul>
      <li>Fully local lakehouse (no cloud services)</li>
      <li>Discogs snapshot dumps processed as deterministic pipeline runs</li>
      <li>Pipeline orchestration with explicit phases and failure handling</li>
      <li>Typed Parquet datasets designed for safe joins and reproducible analytics</li>
    </ul>
  </div>

  <h2>Architecture</h2>
  <div class="card">
    <ul>
      <li><strong>Storage</strong>: external immutable Parquet files</li>
      <li><strong>Metadata</strong>: Hive Metastore (Postgres-backed)</li>
      <li><strong>Compute</strong>: Trino (stateless)</li>
      <li><strong>Orchestration</strong>: Digdag workflows governing pipeline execution</li>
    </ul>

    <p class="muted small" style="margin-top:10px;">
      Pipelines are executed as ordered workflows with explicit dependencies and guarded promotion.
    </p>
  </div>

  <h2>Pipeline design</h2>
  <div class="card">
    <ul>
      <li>Each execution generates a unique, immutable run directory</li>
      <li>Run identifiers are computed once and propagated to all tasks</li>
      <li>Ingest, build, test and promotion are isolated pipeline phases</li>
      <li>Promotion is allowed only after all validations succeed</li>
    </ul>
  </div>

  <h2>Data philosophy</h2>
  <div class="card">
    <ul>
      <li>Canonical datasets preserve Discogs data faithfully</li>
      <li>Identifiers are typed wherever possible</li>
      <li>Ambiguous fields remain textual to avoid false precision</li>
      <li>Interpretation is applied explicitly at analytical level</li>
    </ul>
  </div>

  <h2>Reproducibility & audit</h2>
  <div class="card">
    <ul>
      <li>No dataset is ever overwritten</li>
      <li>Publishing is atomic via an <code>active</code> pointer switch</li>
      <li>Failed runs never affect consumers</li>
      <li>Each run produces permanent validation and sanity reports</li>
    </ul>
  </div>

  <h2>Repositories</h2>
  <div class="card">
    <ul>
      <li>
        <a href={repoInfra} target="_blank" rel="noopener noreferrer">
          Infrastructure (Trino + Hive Metastore)
        </a>
      </li>
      <li>
        <a href={repoPipelines} target="_blank" rel="noopener noreferrer">
          Orchestrated pipelines (Digdag)
        </a>
      </li>
      <li>
        <a href={repoMeta} target="_blank" rel="noopener noreferrer">
          Meta repository (overview)
        </a>
      </li>
    </ul>
  </div>

  <h2>Notes</h2>
  <div class="card">
    <p class="muted" style="margin:0;">
      Discogs data is subject to Discogs licensing. This project focuses on data engineering
      architecture, orchestration and reproducibility, and does not redistribute datasets.
    </p>
  </div>
</Base>
